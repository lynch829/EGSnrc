<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>EGSnrc C++ class library: geometry/egs_box/egs_box.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.3 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">EGSnrc C++ class library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>geometry/egs_box/egs_box.cpp</h1>  </div>
</div>
<div class="contents">
<p>The following describes the implementation of a box geometry that can serve as a guide to users for developing their own geometry classes.</p>
<p>Our box geometry class will describe a parallelepiped of a user defined size that defines a single region filled with 1 medium.</p>
<p>As our geometry must be derived from <a class="el" href="classEGS__BaseGeometry.html">EGS_BaseGeometry</a>, we include its header file. We also want to be able to transform the box from being centered about the origin and having its faces parallel to the x-, y- and z-axis to any other location and/or orientation. For that we will employ <a class="el" href="classEGS__AffineTransform.html">affine transformations </a> and therefore also include the transformations header <a href="file:">file:</a> <div class="fragment"><pre class="fragment"><span class="preprocessor">#include &quot;<a class="code" href="egs__base__geometry_8h.html" title="Base geometry class header file.">egs_base_geometry.h</a>&quot;</span>
<span class="preprocessor">#include &quot;<a class="code" href="egs__transformations_8h.html" title="Rotations and affine transformations header.">egs_transformations.h</a>&quot;</span>
</pre></div> As with other geometries, we will be compiling our box class into a shared library. We have to therefore mark the symbols that will be exported from the library. For this purpose we define a macro <code>EGS_BOX_EXPORT</code>, which we define like this <div class="fragment"><pre class="fragment">

<span class="preprocessor">#ifdef WIN32</span>
<span class="preprocessor"></span>
<span class="preprocessor">#ifdef BUILD_BOX_DLL</span>
<span class="preprocessor"></span><span class="preprocessor">#define EGS_BOX_EXPORT __declspec(dllexport)</span>
<span class="preprocessor"></span><span class="preprocessor">#else</span>
<span class="preprocessor"></span><span class="preprocessor">#define EGS_BOX_EXPORT __declspec(dllimport)</span>
<span class="preprocessor"></span><span class="preprocessor">#endif</span>
<span class="preprocessor">#define EGS_BOX_LOCAL</span>

<span class="preprocessor">#else</span>
<span class="preprocessor"></span>
<span class="preprocessor">#ifdef HAVE_VISIBILITY</span>
<span class="preprocessor"></span><span class="preprocessor">#define EGS_BOX_EXPORT __attribute__ ((visibility (&quot;default&quot;)))</span>
<span class="preprocessor">#define EGS_BOX_LOCAL  __attribute__ ((visibility (&quot;hidden&quot;)))</span>
<span class="preprocessor">#else</span>
<span class="preprocessor"></span><span class="preprocessor">#define EGS_BOX_EXPORT</span>
<span class="preprocessor"></span><span class="preprocessor">#define EGS_BOX_LOCAL</span>
<span class="preprocessor">#endif</span>

<span class="preprocessor">#endif</span>
</pre></div> We are now ready to develop our box geometry class by deriving from <a class="el" href="classEGS__BaseGeometry.html">EGS_BaseGeometry</a>: <div class="fragment"><pre class="fragment">
<span class="keyword">class </span>EGS_BOX_EXPORT <a name="_a0"></a><a class="code" href="classEGS__Box.html" title="A box geometry.">EGS_Box</a> : <span class="keyword">public</span> <a name="_a1"></a><a class="code" href="classEGS__BaseGeometry.html">EGS_BaseGeometry</a> {

    EGS_Float           ax, ay, az;
    <a name="_a2"></a><a class="code" href="classEGS__AffineTransform.html" title="A class providing affine transformations.">EGS_AffineTransform</a> *T;
    <span class="keyword">static</span> <span class="keywordtype">string</span>       type;

<span class="keyword">public</span>:
</pre></div> The data members <code>ax,ay,az</code> are for the box size, the <code>type</code> static data member will be set to "EGS_Box" and used and the <code>T</code> data member will point to the affine transformation associated with boxes not located about the origin and/or rotated boxes. We now need a constructor and a destructor for box objects. We provide two different constructors: one for boxes where all sides have the same size (<em>i.e</em>. cubes) <div class="fragment"><pre class="fragment">
    <a class="code" href="classEGS__Box.html" title="A box geometry.">EGS_Box</a>(EGS_Float a, <span class="keyword">const</span> <a class="code" href="classEGS__AffineTransform.html" title="A class providing affine transformations.">EGS_AffineTransform</a> *t = 0,
            <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;Name = <span class="stringliteral">&quot;&quot;</span>) : <a class="code" href="classEGS__BaseGeometry.html">EGS_BaseGeometry</a>(Name),
            ax(a), ay(a), az(a), T(0)  {
        <span class="keywordflow">if</span>( t ) T = <span class="keyword">new</span> <a class="code" href="classEGS__AffineTransform.html" title="A class providing affine transformations.">EGS_AffineTransform</a>(*t);
        nreg = 1;
    };
</pre></div> and one for boxes with 3 different sides <div class="fragment"><pre class="fragment">
    <a class="code" href="classEGS__Box.html" title="A box geometry.">EGS_Box</a>(EGS_Float Ax, EGS_Float Ay, EGS_Float Az,
            <span class="keyword">const</span> <a class="code" href="classEGS__AffineTransform.html" title="A class providing affine transformations.">EGS_AffineTransform</a> *t = 0,
            <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;Name = <span class="stringliteral">&quot;&quot;</span>) : <a class="code" href="classEGS__BaseGeometry.html">EGS_BaseGeometry</a>(Name),
            ax(Ax), ay(Ay), az(Az), T(0)  {
        <span class="keywordflow">if</span>( t ) T = <span class="keyword">new</span> <a class="code" href="classEGS__AffineTransform.html" title="A class providing affine transformations.">EGS_AffineTransform</a>(*t);
        nreg = 1;
    };
</pre></div> In the destructor we simply deallocate the memory used by the affine transformation, if there was a transformation defined: <div class="fragment"><pre class="fragment">
    ~<a class="code" href="classEGS__Box.html" title="A box geometry.">EGS_Box</a>() { <span class="keywordflow">if</span>( T ) <span class="keyword">delete</span> T; };
</pre></div> We can now start implementing the required geometry methods <a class="el" href="classEGS__BaseGeometry.html#a816bf2d26bdabc3e4ee2f092bd903d92">isInside() </a>, <a class="el" href="classEGS__BaseGeometry.html#af1a37ed6f281a2442a7e96d9658894a9">isWhere() </a>, <a class="el" href="classEGS__BaseGeometry.html#a42a459b557011291ea2e8978ebee6295">howfar() </a> and <a class="el" href="classEGS__BaseGeometry.html#a111e6d8ea34e403bebaf3621223950d9">hownear() </a>.</p>
<p>A point is inside a box about the origin if its x-position is between <code>-ax/2</code> and <code>ax/2</code>, its y-position between <code>-ay/2</code> and <code>ay/2</code>, etc. For a transformed box, the easiest way to determine if the position is inside the box is to apply the inverse transformation to the position and to then use the simple method for boxes about the origin. The <code>isInside</code> implementation therefore looks like this <div class="fragment"><pre class="fragment">
    <span class="keywordtype">bool</span> isInside(<span class="keyword">const</span> <a name="_a3"></a><a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a> &amp;x) {
        <a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a> xp = T ? x*(*T) : x;
        <span class="keywordflow">if</span>( 2*xp.<a name="a4"></a><a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a> + ax &lt; 0 || 2*xp.x - ax &gt; 0 ) <span class="keywordflow">return</span> <span class="keyword">false</span>;
        <span class="keywordflow">if</span>( 2*xp.<a name="a5"></a><a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a> + ay &lt; 0 || 2*xp.y - ay &gt; 0 ) <span class="keywordflow">return</span> <span class="keyword">false</span>;
        <span class="keywordflow">if</span>( 2*xp.<a name="a6"></a><a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a> + az &lt; 0 || 2*xp.z - az &gt; 0 ) <span class="keywordflow">return</span> <span class="keyword">false</span>;
        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    };
</pre></div> (multiplying the position vector with <code>*T</code> from the right is an operation equivalent to transforming <code>x</code> with the inverse of <code>*T</code>)</p>
<p>The implementation of the <code>isWhere</code> method is very easy: as we have a single region this function should return 0 if the position is inside and -1 if it is outside: <div class="fragment"><pre class="fragment">
    <span class="keywordtype">int</span> isWhere(<span class="keyword">const</span> <a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a> &amp;x) { <span class="keywordflow">return</span> isInside(x) ? 0 : -1; };
</pre></div></p>
<p>The implementation of the <code>howfar</code> method is also easiest if we first transform the position and direction to a frame where the box is centered about the origin and its sides are parallel to the axis: <div class="fragment"><pre class="fragment">    <span class="keywordtype">int</span> howfar(<span class="keywordtype">int</span> ireg, <span class="keyword">const</span> <a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a> &amp;x, <span class="keyword">const</span> <a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a> &amp;u,
            EGS_Float &amp;t, <span class="keywordtype">int</span> *newmed=0, <a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a> *normal=0) {
        <a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a> xp(x), up(u);
        <span class="keywordflow">if</span>( T ) { xp = x*(*T); up = u*T-&gt;getRotation(); }
</pre></div> The <code>howfar</code> logic is different for positions inside (<em>i.e</em>. <code>ireg=0</code> ) and outside. For inside points, we must calculate the distances to the x-planes, y-planes and z-planes from the transformed point <code>xp</code> along the transformed direction <code>up</code> and take the minimum <code>t1</code> of the three. If <code>t1</code> is less than the intended step <code>t</code>, we must set <code>t</code> to <code>t1</code> and return -1 (<em>i.e</em>. the particle will exit the box at the end of the step). If <code>normal</code> is not <code>null</code>, our <code>howfar</code> function is being called from the visualization utility and we must also calculate the normal of the plane being intersected to exit the box with the normal pointing towards the position of the particle. The implementation therefore looks like this <div class="fragment"><pre class="fragment">        <span class="keywordflow">if</span>( ireg == 0  ) {
            EGS_Float t1 = 1e30; <span class="keywordtype">int</span> inew = 0; <a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a> n;
            <span class="keywordflow">if</span>( up.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a> &gt; 0 ) { t1 = (ax - 2*xp.x)/(2*up.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a>); n.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a> = -1; }
            <span class="keywordflow">else</span> <span class="keywordflow">if</span>( up.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a> &lt; 0 ) { t1 = -(ax + 2*xp.x)/(2*up.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a>); n.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a> = 1; }
            <span class="keywordflow">if</span>( t1 &lt; t ) { t = t1; inew = -1; }
            t1 = 1e30;
            <span class="keywordflow">if</span>( up.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a> &gt; 0 ) t1 = (ay - 2*xp.y)/(2*up.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a>);
            <span class="keywordflow">else</span> <span class="keywordflow">if</span>( up.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a> &lt; 0 ) t1 = -(ay + 2*xp.y)/(2*up.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a>);
            <span class="keywordflow">if</span>( t1 &lt; t ) {
                n.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a> = 0; n.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a> = up.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a> &gt; 0 ? -1 : 1;
                t = t1; inew = -1;
            }
            t1 = 1e30;
            <span class="keywordflow">if</span>( up.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a> &gt; 0 ) t1 = (az - 2*xp.z)/(2*up.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a>);
            <span class="keywordflow">else</span> <span class="keywordflow">if</span>( up.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a> &lt; 0 ) t1 = -(az + 2*xp.z)/(2*up.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a>);
            <span class="keywordflow">if</span>( t1 &lt; t ) {
                t = t1; inew = -1;
                n.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a> = n.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a> = 0; n.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a> = up.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a> &gt; 0 ? -1 : 1;
            }
            <span class="keywordflow">if</span>( inew &lt; 0 ) {
                <span class="keywordflow">if</span>( newmed ) *newmed = -1;
                <span class="keywordflow">if</span>( normal ) {
                    <span class="keywordflow">if</span>( T ) *normal = T-&gt;getRotation()*n;
                    <span class="keywordflow">else</span> *normal = n;
                }
            }
            <span class="keywordflow">return</span> inew;
        }
</pre></div> When the position is outside, the logic is</p>
<ol type="1">
<li>if the particle intersects the top or bottom side, check if the intersection point is between the left-right and east-west sides.</li>
<li>If yes, this is the position where the trajectory is entering the box =&gt; return the required information</li>
<li>If no, repeat 1-2 for left-right sides and if necessary for the east-west sides.</li>
<li>If all of the above fails, the particle does not enter the box.</li>
</ol>
<p>The code is lengthy and not reproduced here.</p>
<p>The next step is the implementation of the <code>hownear</code> function. As with the other methods, we first inverse transform the position and then calculate the minimum distance to a box about the origin <div class="fragment"><pre class="fragment">    EGS_Float hownear(<span class="keywordtype">int</span> ireg, <span class="keyword">const</span> <a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a> &amp;x) {
        <a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a> xp = T ? x*(*T) : x;
</pre></div> If the position is inside the boxe (<em>i.e</em>. <code>ireg=0</code>), the minimum distance to a boundary is the minimum distance to any of the 6 faces: <div class="fragment"><pre class="fragment">        <span class="keywordflow">if</span>( ireg &gt;= 0 ) {
            EGS_Float tmin;
            EGS_Float t1 = xp.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a> + 0.5*ax, t2 = 0.5*ax - xp.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a>;
            <span class="keywordflow">if</span>( t1 &lt; t2 ) tmin = t1; <span class="keywordflow">else</span> tmin = t2;
            t1 = xp.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a> + 0.5*ay; <span class="keywordflow">if</span>( t1 &lt; tmin ) tmin = t1;
            t1 = 0.5*ay - xp.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a>; <span class="keywordflow">if</span>( t1 &lt; tmin ) tmin = t1;
            t1 = xp.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a> + 0.5*az; <span class="keywordflow">if</span>( t1 &lt; tmin ) tmin = t1;
            t1 = 0.5*az - xp.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a>; <span class="keywordflow">if</span>( t1 &lt; tmin ) tmin = t1;
            <span class="keywordflow">return</span> tmin;
        }
</pre></div> If the position is outside, the algorithm is slightly more difficult and is left to the reader to understand from the implementation: <div class="fragment"><pre class="fragment">        EGS_Float s1=0, s2=0; <span class="keywordtype">int</span> nout = 0;
        <span class="keywordflow">if</span>( 2*xp.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a> + ax &lt; 0 ) {
            EGS_Float t = -0.5*ax - xp.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a>; s1 += t; s2 += t*t; nout++;
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(2*xp.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a> - ax &gt; 0) {
           EGS_Float t = xp.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a> - 0.5*ax; s1 += t; s2 += t*t;  nout++;
        }
        <span class="keywordflow">if</span>( 2*xp.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a> + ay &lt; 0 ) {
            EGS_Float t = -0.5*ay - xp.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a>; s1 += t; s2 += t*t; nout++;
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(2*xp.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a> - ay &gt; 0) {
           EGS_Float t = xp.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a> - 0.5*ay; s1 += t; s2 += t*t;  nout++;
        }
        <span class="keywordflow">if</span>( 2*xp.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a> + az &lt; 0 ) {
            EGS_Float t = -0.5*az - xp.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a>; s1 += t; s2 += t*t; nout++;
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(2*xp.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a> - az &gt; 0) {
           EGS_Float t = xp.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a> - 0.5*az; s1 += t; s2 += t*t;  nout++;
        }
        <span class="keywordflow">if</span>( nout &lt; 2 ) <span class="keywordflow">return</span> s1;
        <span class="keywordflow">return</span> sqrt(s2);
    };
</pre></div></p>
<p>We reimplement the <code>getType</code> function to return <code>type</code> so that the type of our geometry class is known: <div class="fragment"><pre class="fragment">
    <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;getType()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> type; };
</pre></div></p>
<p>We also reimplement the <a class="el" href="classEGS__BaseGeometry.html#a90b349e45353ab0b7fa32053a9d37085">printInfo() </a> function so that users of our geometry class can get a better description of the geometry object: <div class="fragment"><pre class="fragment">
    <span class="keywordtype">void</span> printInfo() <span class="keyword">const</span>;

};
</pre></div> The actual implementation of <code>printInfo</code> is in the <a class="el" href="egs__box_8cpp.html" title="A box geometry: implementation.">egs_box.cpp</a> file, which includes <code><a class="el" href="egs__box_8h.html" title="A box geometry: header.">egs_box.h</a></code> and <code><a class="el" href="egs__input_8h.html" title="EGS_Input header file.">egs_input.h</a>:</code>  <div class="fragment"><pre class="fragment"><span class="comment">/*</span>
<span class="comment">###############################################################################</span>
<span class="comment">#</span>
<span class="comment">#  EGSnrc egs++ box geometry</span>
<span class="comment">#  Copyright (C) 2015 National Research Council Canada</span>
<span class="comment">#</span>
<span class="comment">#  This file is part of EGSnrc.</span>
<span class="comment">#</span>
<span class="comment">#  EGSnrc is free software: you can redistribute it and/or modify it under</span>
<span class="comment">#  the terms of the GNU Affero General Public License as published by the</span>
<span class="comment">#  Free Software Foundation, either version 3 of the License, or (at your</span>
<span class="comment">#  option) any later version.</span>
<span class="comment">#</span>
<span class="comment">#  EGSnrc is distributed in the hope that it will be useful, but WITHOUT ANY</span>
<span class="comment">#  WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</span>
<span class="comment">#  FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for</span>
<span class="comment">#  more details.</span>
<span class="comment">#</span>
<span class="comment">#  You should have received a copy of the GNU Affero General Public License</span>
<span class="comment">#  along with EGSnrc. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="comment">#</span>
<span class="comment">###############################################################################</span>
<span class="comment">#</span>
<span class="comment">#  Author:          Iwan Kawrakow, 2005</span>
<span class="comment">#</span>
<span class="comment">#  Contributors:    Frederic Tessier</span>
<span class="comment">#</span>
<span class="comment">###############################################################################</span>
<span class="comment">*/</span>


<span class="preprocessor">#include &quot;<a class="code" href="egs__box_8h.html" title="A box geometry: header.">egs_box.h</a>&quot;</span>
<span class="preprocessor">#include &quot;<a class="code" href="egs__input_8h.html" title="EGS_Input header file.">egs_input.h</a>&quot;</span>
</pre></div> The latter is necessary to gain access to the definition of the <a class="el" href="classEGS__Input.html" title="A class for storing information in a tree-like structure of key-value pairs. This class is used throu...">EGS_Input</a> class that is needed in the <code>createGeometry</code> function (see below). The <code>printInfo</code> implementation is simple: <div class="fragment"><pre class="fragment"><span class="keywordtype">void</span> EGS_Box::printInfo()<span class="keyword"> const </span>{
    <a name="a7"></a><a class="code" href="classEGS__BaseGeometry.html#a90b349e45353ab0b7fa32053a9d37085" title="Print information about this geometry.">EGS_BaseGeometry::printInfo</a>();
    <a name="a8"></a><a class="code" href="group__egspp__main.html#ga38c38ac950788399c630481c2b3722f2" title="Always use this function for reporting the progress of a simulation and any other type of information...">egsInformation</a>(<span class="stringliteral">&quot; box size = %g %g %g\n&quot;</span>,ax,ay,az);
    <a class="code" href="group__egspp__main.html#ga38c38ac950788399c630481c2b3722f2" title="Always use this function for reporting the progress of a simulation and any other type of information...">egsInformation</a>(<span class="stringliteral">&quot;=======================================================\n&quot;</span>);
}
</pre></div></p>
<p>We also need to declare the static data member <code>type</code> <div class="fragment"><pre class="fragment">
<span class="keywordtype">string</span> EGS_Box::type(<span class="stringliteral">&quot;EGS_Box&quot;</span>);
</pre></div> According to verious sources, compilers can produce better code if text strings are static and local to the library. Hence, we define the various error messages and the key we will be using to define the size of a box object as such: <div class="fragment"><pre class="fragment">
<span class="keyword">static</span> <span class="keywordtype">char</span> EGS_BOX_LOCAL ebox_message1[] = <span class="stringliteral">&quot;createGeometry(box): %s\n&quot;</span>;
<span class="keyword">static</span> <span class="keywordtype">char</span> EGS_BOX_LOCAL ebox_message2[] = <span class="stringliteral">&quot;null input?&quot;</span>;
<span class="keyword">static</span> <span class="keywordtype">char</span> EGS_BOX_LOCAL ebox_message3[] = <span class="stringliteral">&quot;wrong/missing &#39;box size&#39; input?&quot;</span>;
<span class="keyword">static</span> <span class="keywordtype">char</span> EGS_BOX_LOCAL ebox_message4[] =
  <span class="stringliteral">&quot;expecting 1 or 3 float inputs for &#39;box size&#39;&quot;</span>;
<span class="keyword">static</span> <span class="keywordtype">char</span> EGS_BOX_LOCAL ebox_key1[] = <span class="stringliteral">&quot;box size&quot;</span>;
</pre></div></p>
<p>The remaining task now is to provide a C-style function named <code>createGeometry</code> for the box shared library that will be used to dynamically create box objects based on the information stored in an <a class="el" href="classEGS__Input.html" title="A class for storing information in a tree-like structure of key-value pairs. This class is used throu...">EGS_Input</a> object. <div class="fragment"><pre class="fragment">
<span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> {

EGS_BOX_EXPORT <a class="code" href="classEGS__BaseGeometry.html">EGS_BaseGeometry</a>* createGeometry(<a name="_a9"></a><a class="code" href="classEGS__Input.html" title="A class for storing information in a tree-like structure of key-value pairs. This class is used throu...">EGS_Input</a> *input) {
</pre></div> Just to be sure, we check that <code>input</code> is not <code>null</code> and issue a warning and return <code>null</code> if it is: <div class="fragment"><pre class="fragment">    <span class="keywordflow">if</span>( !input ) { <a name="a10"></a><a class="code" href="group__egspp__main.html#gadf4109d942f372e48e1dea86c0ca62cb" title="Always use this function for reporting warnings.">egsWarning</a>(ebox_message1,ebox_message2); <span class="keywordflow">return</span> 0; }
</pre></div> We then check if the input object contains a <code>box size</code> property <div class="fragment"><pre class="fragment">    vector&lt;EGS_Float&gt; s;
    <span class="keywordtype">int</span> err = input-&gt;<a name="a11"></a><a class="code" href="classEGS__Input.html#a154f3de14ebb23c3e78316b40b33b719" title="Assign values to an array of strings from an input identified by key.">getInput</a>(ebox_key1,s);
</pre></div> and if it doesn't (indicated by <code>err</code> not being zero), issue a warning and return <code>null:</code> <div class="fragment"><pre class="fragment">    <span class="keywordflow">if</span>( err ) {
        <a class="code" href="group__egspp__main.html#gadf4109d942f372e48e1dea86c0ca62cb" title="Always use this function for reporting warnings.">egsWarning</a>(ebox_message1,ebox_message3); <span class="keywordflow">return</span> 0;
    }
</pre></div> Next we check if the input contains a definition if a transformation for our box geometry: <div class="fragment"><pre class="fragment">    <a class="code" href="classEGS__AffineTransform.html" title="A class providing affine transformations.">EGS_AffineTransform</a> *t = <a name="a12"></a><a class="code" href="classEGS__AffineTransform.html#a601a07115aecff1925956a9097e69950" title="Constructs an affine transformation object from the input pointed to by inp and returns a pointer to ...">EGS_AffineTransform::getTransformation</a>(input);
</pre></div> Depending on whether there was one or three values to the <code>box size</code> key, we use the corresponding constructor to create the new box object, but refuse to create it if there was some other number of values (because, <em>e.g</em>., the user made a mistake in the input file): <div class="fragment"><pre class="fragment">    <a class="code" href="classEGS__Box.html" title="A box geometry.">EGS_Box</a> *result;
    <span class="keywordflow">if</span>( s.size() == 1 ) result = <span class="keyword">new</span> <a class="code" href="classEGS__Box.html" title="A box geometry.">EGS_Box</a>(s[0],t);
    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( s.size() == 3 ) result = <span class="keyword">new</span> <a class="code" href="classEGS__Box.html" title="A box geometry.">EGS_Box</a>(s[0],s[1],s[2],t);
    <span class="keywordflow">else</span> {
        <a class="code" href="group__egspp__main.html#gadf4109d942f372e48e1dea86c0ca62cb" title="Always use this function for reporting warnings.">egsWarning</a>(ebox_message1,ebox_message4);
        <span class="keywordflow">if</span>( t ) <span class="keyword">delete</span> t; <span class="keywordflow">return</span> 0;
    }
</pre></div> We must now delete the affine transformation pointed to by <code>t</code> as the box object has made its own copy in the constructor <div class="fragment"><pre class="fragment">    <span class="keywordflow">if</span>( t ) <span class="keyword">delete</span> t;
</pre></div> We then use the <code>setName</code> and <code>setMedia</code> functions inherited from <a class="el" href="classEGS__BaseGeometry.html">EGS_BaseGeometry</a> to set the name of the newly created box and fill it with a medium <div class="fragment"><pre class="fragment">    result-&gt;<a name="a13"></a><a class="code" href="classEGS__BaseGeometry.html#a77e25cd36d6d94f26338cca9bc98b97d" title="Set the name of the geometry from the input inp.">setName</a>(input);
</pre></div> to then return the box <div class="fragment"><pre class="fragment">    result-&gt;<a name="a14"></a><a class="code" href="classEGS__BaseGeometry.html#a28bf612777de14f97108021ae7eb3865" title="Set the media in the geometry from the input pointed to by inp.">setMedia</a>(input);
    result-&gt;<a name="a15"></a><a class="code" href="classEGS__BaseGeometry.html#abc5fa5c48edfbbd913e1939299fe5286" title="Set the labels from an input block.">setLabels</a>(input);
    <span class="keywordflow">return</span> result;
}

}
</pre></div></p>
<p>Based on this <code>createGeometry</code> implementation, users will be able to use our box geometry class by having the following input in the input file </p>
<div class="fragment"><pre class="fragment">
    :start geometry:
        name = some_name
        box size = 3.5 1 7
        :start transformation:
            input defining the transformation
        :stop transformation
        :start media input:
            media = H2O
        :stop media input
    :stop geometry:
    </pre></div><p> The transformation related input can be of course missing in which case the box will be centered about the origin and has its faces parallel to the x-, y- and z-axis.</p>
<p>If we would have been nice to the users of our box geometry class, we could have provided an easier way for defining the medium of the box by re-implementing the <a class="el" href="classEGS__BaseGeometry.html#a28bf612777de14f97108021ae7eb3865">setMedia() </a> function, <em>e.g</em>. something along these lines: </p>
<div class="fragment"><pre class="fragment">
    void EGS_Box::setMedia(EGS_Input *inp) {
        string medname; int err = inp-&gt;getInput("medium",medname);
        if( !err ) setMedium(medname);
    }
    </pre></div><p> That way, the user could define the medium of the box by simply using </p>
<div class="fragment"><pre class="fragment">
    medium = H2O
    </pre></div><p> instead of <code>:start media input: ... :stop media input:</code> which is necessary for geometries with several regions and potentialy different media and therefore provided as default implementation.</p>
<p>The final step is to provide a Makefile for our geometry DSO.  We include the config files containing various definitions for the make system: <div class="fragment"><pre class="fragment">include $(EGS_CONFIG)
include $(SPEC_DIR)egspp.spec
include $(SPEC_DIR)egspp_$(my_machine).conf
</pre></div> We then must add the <code>BUILD_BOX_DLL</code> macro to the list of defined macros, <div class="fragment"><pre class="fragment">
DEFS = $(DEF1) -DBUILD_BOX_DLL
</pre></div> set the name of the DSO, <div class="fragment"><pre class="fragment">
library = egs_box
</pre></div> define the source files needed to create the DSO, <div class="fragment"><pre class="fragment">lib_files = egs_box
</pre></div> and tell the make system that our class depends on the <a class="el" href="egs__transformations_8h.html" title="Rotations and affine transformations header.">egs_transformations.h</a> header file, <div class="fragment"><pre class="fragment">my_deps = egs_transformations.h
extra_dep = $(addprefix $(DSOLIBS), $(my_deps))
</pre></div> We can then use the generic rules for building the DSO: <div class="fragment"><pre class="fragment">
include $(SPEC_DIR)egspp_libs.spec
</pre></div> and because our only object file needed to build the library depends on <code>egs_box</code>.cpp and <code>egs_box</code>.h, we can also use the generic dependence rule <div class="fragment"><pre class="fragment">
$(make_depend)
</pre></div> That's all.</p>
<p>Here is the complete source code of the <a class="el" href="classEGS__Box.html" title="A box geometry.">EGS_Box</a> class.<br/>
 The header <a href="file:">file:</a> </p>
<div class="fragment"><pre class="fragment"><span class="comment">/*</span>
<span class="comment">###############################################################################</span>
<span class="comment">#</span>
<span class="comment">#  EGSnrc egs++ box geometry headers</span>
<span class="comment">#  Copyright (C) 2015 National Research Council Canada</span>
<span class="comment">#</span>
<span class="comment">#  This file is part of EGSnrc.</span>
<span class="comment">#</span>
<span class="comment">#  EGSnrc is free software: you can redistribute it and/or modify it under</span>
<span class="comment">#  the terms of the GNU Affero General Public License as published by the</span>
<span class="comment">#  Free Software Foundation, either version 3 of the License, or (at your</span>
<span class="comment">#  option) any later version.</span>
<span class="comment">#</span>
<span class="comment">#  EGSnrc is distributed in the hope that it will be useful, but WITHOUT ANY</span>
<span class="comment">#  WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</span>
<span class="comment">#  FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for</span>
<span class="comment">#  more details.</span>
<span class="comment">#</span>
<span class="comment">#  You should have received a copy of the GNU Affero General Public License</span>
<span class="comment">#  along with EGSnrc. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="comment">#</span>
<span class="comment">###############################################################################</span>
<span class="comment">#</span>
<span class="comment">#  Author:          Iwan Kawrakow, 2005</span>
<span class="comment">#</span>
<span class="comment">#  Contributors:</span>
<span class="comment">#</span>
<span class="comment">###############################################################################</span>
<span class="comment">*/</span>


<span class="preprocessor">#ifndef EGS_BOX_</span>
<span class="preprocessor"></span><span class="preprocessor">#define EGS_BOX_</span>
<span class="preprocessor"></span>
<span class="preprocessor">#include &quot;<a class="code" href="egs__base__geometry_8h.html" title="Base geometry class header file.">egs_base_geometry.h</a>&quot;</span>
<span class="preprocessor">#include &quot;<a class="code" href="egs__transformations_8h.html" title="Rotations and affine transformations header.">egs_transformations.h</a>&quot;</span>


<span class="preprocessor">#ifdef WIN32</span>
<span class="preprocessor"></span>
<span class="preprocessor">#ifdef BUILD_BOX_DLL</span>
<span class="preprocessor"></span><span class="preprocessor">#define EGS_BOX_EXPORT __declspec(dllexport)</span>
<span class="preprocessor"></span><span class="preprocessor">#else</span>
<span class="preprocessor"></span><span class="preprocessor">#define EGS_BOX_EXPORT __declspec(dllimport)</span>
<span class="preprocessor"></span><span class="preprocessor">#endif</span>
<span class="preprocessor"></span><span class="preprocessor">#define EGS_BOX_LOCAL</span>
<span class="preprocessor"></span>
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>
<span class="preprocessor">#ifdef HAVE_VISIBILITY</span>
<span class="preprocessor"></span><span class="preprocessor">#define EGS_BOX_EXPORT __attribute__ ((visibility (&quot;default&quot;)))</span>
<span class="preprocessor"></span><span class="preprocessor">#define EGS_BOX_LOCAL  __attribute__ ((visibility (&quot;hidden&quot;)))</span>
<span class="preprocessor"></span><span class="preprocessor">#else</span>
<span class="preprocessor"></span><span class="preprocessor">#define EGS_BOX_EXPORT</span>
<span class="preprocessor"></span><span class="preprocessor">#define EGS_BOX_LOCAL</span>
<span class="preprocessor"></span><span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
<span class="keyword">class </span>EGS_BOX_EXPORT <a class="code" href="classEGS__Box.html" title="A box geometry.">EGS_Box</a> : <span class="keyword">public</span> <a class="code" href="classEGS__BaseGeometry.html">EGS_BaseGeometry</a> {

    EGS_Float           ax, ay, az;
    <a class="code" href="classEGS__AffineTransform.html" title="A class providing affine transformations.">EGS_AffineTransform</a> *T;
    <span class="keyword">static</span> <span class="keywordtype">string</span>       type;

<span class="keyword">public</span>:

    <a class="code" href="classEGS__Box.html" title="A box geometry.">EGS_Box</a>(EGS_Float a, <span class="keyword">const</span> <a class="code" href="classEGS__AffineTransform.html" title="A class providing affine transformations.">EGS_AffineTransform</a> *t = 0,
            <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;Name = <span class="stringliteral">&quot;&quot;</span>) : <a name="a16"></a><a class="code" href="classEGS__BaseGeometry.html#ae3035a8e9f808e89340c65e8d2b6930f" title="Construct a geometry named Name.">EGS_BaseGeometry</a>(Name),
            ax(a), ay(a), az(a), T(0)  {
        <span class="keywordflow">if</span>( t ) T = <span class="keyword">new</span> <a class="code" href="classEGS__AffineTransform.html" title="A class providing affine transformations.">EGS_AffineTransform</a>(*t);
        nreg = 1;
    };

    <a class="code" href="classEGS__Box.html" title="A box geometry.">EGS_Box</a>(EGS_Float Ax, EGS_Float Ay, EGS_Float Az,
            <span class="keyword">const</span> <a class="code" href="classEGS__AffineTransform.html" title="A class providing affine transformations.">EGS_AffineTransform</a> *t = 0,
            <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;Name = <span class="stringliteral">&quot;&quot;</span>) : <a class="code" href="classEGS__BaseGeometry.html#ae3035a8e9f808e89340c65e8d2b6930f" title="Construct a geometry named Name.">EGS_BaseGeometry</a>(Name),
            ax(Ax), ay(Ay), az(Az), T(0)  {
        <span class="keywordflow">if</span>( t ) T = <span class="keyword">new</span> <a class="code" href="classEGS__AffineTransform.html" title="A class providing affine transformations.">EGS_AffineTransform</a>(*t);
        nreg = 1;
    };

    ~<a class="code" href="classEGS__Box.html" title="A box geometry.">EGS_Box</a>() { <span class="keywordflow">if</span>( T ) <span class="keyword">delete</span> T; };

    <span class="keywordtype">bool</span> <a name="a17"></a><a class="code" href="classEGS__BaseGeometry.html#a816bf2d26bdabc3e4ee2f092bd903d92" title="Is the position x inside the geometry?">isInside</a>(<span class="keyword">const</span> <a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a> &amp;x) {
        <a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a> xp = T ? x*(*T) : x;
        <span class="keywordflow">if</span>( 2*xp.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a> + ax &lt; 0 || 2*xp.x - ax &gt; 0 ) <span class="keywordflow">return</span> <span class="keyword">false</span>;
        <span class="keywordflow">if</span>( 2*xp.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a> + ay &lt; 0 || 2*xp.y - ay &gt; 0 ) <span class="keywordflow">return</span> <span class="keyword">false</span>;
        <span class="keywordflow">if</span>( 2*xp.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a> + az &lt; 0 || 2*xp.z - az &gt; 0 ) <span class="keywordflow">return</span> <span class="keyword">false</span>;
        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    };

    <span class="keywordtype">int</span> <a name="a18"></a><a class="code" href="classEGS__BaseGeometry.html#af1a37ed6f281a2442a7e96d9658894a9" title="In which region is poisition x?">isWhere</a>(<span class="keyword">const</span> <a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a> &amp;x) { <span class="keywordflow">return</span> <a class="code" href="classEGS__BaseGeometry.html#a816bf2d26bdabc3e4ee2f092bd903d92" title="Is the position x inside the geometry?">isInside</a>(x) ? 0 : -1; };

    <span class="keywordtype">int</span> <a name="a19"></a><a class="code" href="classEGS__BaseGeometry.html#a15008e08ea330694841fc94b64a7e8d5" title="Returns the region index, if inside, or -1 if outside (obsolete)">inside</a>(<span class="keyword">const</span> <a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a> &amp;x) { <span class="keywordflow">return</span> <a class="code" href="classEGS__BaseGeometry.html#af1a37ed6f281a2442a7e96d9658894a9" title="In which region is poisition x?">isWhere</a>(x); };

    EGS_Float <a name="a20"></a><a class="code" href="classEGS__BaseGeometry.html#a217bc8dd7706a988acaf97165edb6435">howfarToOutside</a>(<span class="keywordtype">int</span> ireg, <span class="keyword">const</span> <a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a> &amp;x,
                        <span class="keyword">const</span> <a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a> &amp;u) {
        EGS_Float t = 1e30;
        <a name="a21"></a><a class="code" href="classEGS__BaseGeometry.html#a42a459b557011291ea2e8978ebee6295" title="Calculate the distance to a boundary from x along the direction u.">howfar</a>(ireg,x,u,t); <span class="keywordflow">return</span> t;
    };

    <span class="keywordtype">int</span> <a class="code" href="classEGS__BaseGeometry.html#a42a459b557011291ea2e8978ebee6295" title="Calculate the distance to a boundary from x along the direction u.">howfar</a>(<span class="keywordtype">int</span> ireg, <span class="keyword">const</span> <a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a> &amp;x, <span class="keyword">const</span> <a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a> &amp;u,
            EGS_Float &amp;t, <span class="keywordtype">int</span> *newmed=0, <a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a> *normal=0) {
        <a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a> xp(x), up(u);
        <span class="keywordflow">if</span>( T ) { xp = x*(*T); up = u*T-&gt;getRotation(); }
        <span class="keywordflow">if</span>( ireg == 0  ) {
            EGS_Float t1 = 1e30; <span class="keywordtype">int</span> inew = 0; <a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a> n;
            <span class="keywordflow">if</span>( up.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a> &gt; 0 ) { t1 = (ax - 2*xp.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a>)/(2*up.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a>); n.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a> = -1; }
            <span class="keywordflow">else</span> <span class="keywordflow">if</span>( up.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a> &lt; 0 ) { t1 = -(ax + 2*xp.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a>)/(2*up.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a>); n.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a> = 1; }
            <span class="keywordflow">if</span>( t1 &lt; t ) { t = t1; inew = -1; }
            t1 = 1e30;
            <span class="keywordflow">if</span>( up.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a> &gt; 0 ) t1 = (ay - 2*xp.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a>)/(2*up.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a>);
            <span class="keywordflow">else</span> <span class="keywordflow">if</span>( up.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a> &lt; 0 ) t1 = -(ay + 2*xp.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a>)/(2*up.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a>);
            <span class="keywordflow">if</span>( t1 &lt; t ) {
                n.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a> = 0; n.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a> = up.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a> &gt; 0 ? -1 : 1;
                t = t1; inew = -1;
            }
            t1 = 1e30;
            <span class="keywordflow">if</span>( up.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a> &gt; 0 ) t1 = (az - 2*xp.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a>)/(2*up.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a>);
            <span class="keywordflow">else</span> <span class="keywordflow">if</span>( up.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a> &lt; 0 ) t1 = -(az + 2*xp.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a>)/(2*up.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a>);
            <span class="keywordflow">if</span>( t1 &lt; t ) {
                t = t1; inew = -1;
                n.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a> = n.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a> = 0; n.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a> = up.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a> &gt; 0 ? -1 : 1;
            }
            <span class="keywordflow">if</span>( inew &lt; 0 ) {
                <span class="keywordflow">if</span>( newmed ) *newmed = -1;
                <span class="keywordflow">if</span>( normal ) {
                    <span class="keywordflow">if</span>( T ) *normal = T-&gt;getRotation()*n;
                    <span class="keywordflow">else</span> *normal = n;
                }
            }
            <span class="keywordflow">return</span> inew;
        }
        EGS_Float t1 = 1e30;
        <span class="keywordflow">if</span>( 2*xp.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a> + ax &lt; 0 &amp;&amp; up.x &gt; 0 ) t1 = -(2*xp.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a> + ax)/(2*up.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a>);
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( 2*xp.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a> - ax &gt; 0 &amp;&amp; up.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a> &lt; 0 ) t1 = -(2*xp.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a> - ax)/(2*up.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a>);
        <span class="keywordflow">if</span>( t1 &lt; t ) {
            EGS_Float y1 = xp.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a> + up.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a>*t1, z1 = xp.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a> + up.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a>*t1;
            <span class="keywordflow">if</span>( 2*y1 + ay &gt;= 0 &amp;&amp; 2*y1 - ay &lt;= 0 &amp;&amp;
                2*z1 + az &gt;= 0 &amp;&amp; 2*z1 - az &lt;= 0 ) {
                t = t1;
                <span class="keywordflow">if</span>( newmed ) *newmed = <a name="a22"></a><a class="code" href="classEGS__BaseGeometry.html#a9e25deca845a02cb0b7fae1eb06c00d9" title="Medium index.">med</a>;
                <span class="keywordflow">if</span>( normal ) {
                    <span class="keywordflow">if</span>( T ) {
                        <span class="keyword">const</span> <a name="_a23"></a><a class="code" href="classEGS__RotationMatrix.html" title="A class for vector rotations.">EGS_RotationMatrix</a> &amp;R = T-&gt;getRotation();
                        <span class="keywordflow">if</span>( up.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a> &gt; 0 ) *normal = R*<a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a>(-1,0,0);
                        <span class="keywordflow">else</span> *normal = R*EGS_Vector(1,0,0);
                    }
                    <span class="keywordflow">else</span> {
                        <span class="keywordflow">if</span>( up.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a> &gt; 0 ) *normal = <a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a>(-1,0,0);
                        <span class="keywordflow">else</span> *normal = <a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a>(1,0,0);
                    }
                }
                <span class="keywordflow">return</span> 0;
            }
        }
        t1 = 1e30;
        <span class="keywordflow">if</span>( 2*xp.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a> + ay &lt; 0 &amp;&amp; up.y &gt; 0 ) t1 = -(2*xp.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a> + ay)/(2*up.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a>);
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( 2*xp.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a> - ay &gt; 0 &amp;&amp; up.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a> &lt; 0 ) t1 = -(2*xp.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a> - ay)/(2*up.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a>);
        <span class="keywordflow">if</span>( t1 &lt; t ) {
            EGS_Float x1 = xp.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a> + up.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a>*t1, z1 = xp.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a> + up.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a>*t1;
            <span class="keywordflow">if</span>( 2*x1 + ax &gt;= 0 &amp;&amp; 2*x1 - ax &lt;= 0 &amp;&amp;
                2*z1 + az &gt;= 0 &amp;&amp; 2*z1 - az &lt;= 0 ) {
                t = t1;
                <span class="keywordflow">if</span>( newmed ) *newmed = <a class="code" href="classEGS__BaseGeometry.html#a9e25deca845a02cb0b7fae1eb06c00d9" title="Medium index.">med</a>;
                <span class="keywordflow">if</span>( normal ) {
                    <span class="keywordflow">if</span>( T ) {
                        <span class="keyword">const</span> <a class="code" href="classEGS__RotationMatrix.html" title="A class for vector rotations.">EGS_RotationMatrix</a> &amp;R = T-&gt;getRotation();
                        <span class="keywordflow">if</span>( up.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a> &gt; 0 ) *normal = R*<a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a>(0,-1,0);
                        <span class="keywordflow">else</span> *normal = R*EGS_Vector(0,1,0);
                    }
                    <span class="keywordflow">else</span> {
                        <span class="keywordflow">if</span>( up.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a> &gt; 0 ) *normal = <a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a>(0,-1,0);
                        <span class="keywordflow">else</span> *normal = <a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a>(0,1,0);
                    }
                }
                <span class="keywordflow">return</span> 0;
            }
        }
        t1 = 1e30;
        <span class="keywordflow">if</span>( 2*xp.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a> + az &lt; 0 &amp;&amp; up.z &gt; 0 ) t1 = -(2*xp.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a> + az)/(2*up.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a>);
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( 2*xp.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a> - az &gt; 0 &amp;&amp; up.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a> &lt; 0 ) t1 = -(2*xp.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a> - az)/(2*up.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a>);
        <span class="keywordflow">if</span>( t1 &lt; t ) {
            EGS_Float x1 = xp.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a> + up.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a>*t1, y1 = xp.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a> + up.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a>*t1;
            <span class="keywordflow">if</span>( 2*x1 + ax &gt;= 0 &amp;&amp; 2*x1 - ax &lt;= 0 &amp;&amp;
                2*y1 + ay &gt;= 0 &amp;&amp; 2*y1 - ay &lt;= 0 ) {
                t = t1;
                <span class="keywordflow">if</span>( newmed ) *newmed = <a class="code" href="classEGS__BaseGeometry.html#a9e25deca845a02cb0b7fae1eb06c00d9" title="Medium index.">med</a>;
                <span class="keywordflow">if</span>( normal ) {
                    <span class="keywordflow">if</span>( T ) {
                        <span class="keyword">const</span> <a class="code" href="classEGS__RotationMatrix.html" title="A class for vector rotations.">EGS_RotationMatrix</a> &amp;R = T-&gt;getRotation();
                        <span class="keywordflow">if</span>( up.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a> &gt; 0 ) *normal = R*<a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a>(0,0,-1);
                        <span class="keywordflow">else</span> *normal = R*EGS_Vector(0,0,1);
                    }
                    <span class="keywordflow">else</span> {
                        <span class="keywordflow">if</span>( up.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a> &gt; 0 ) *normal = <a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a>(0,0,-1);
                        <span class="keywordflow">else</span> *normal = <a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a>(0,0,1);
                    }
                }
                <span class="keywordflow">return</span> 0;
            }
        }
        <span class="keywordflow">return</span> -1;
    };

    EGS_Float <a name="a24"></a><a class="code" href="classEGS__BaseGeometry.html#a111e6d8ea34e403bebaf3621223950d9" title="Calculate the distance to a boundary for position x in any direction.">hownear</a>(<span class="keywordtype">int</span> ireg, <span class="keyword">const</span> <a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a> &amp;x) {
        <a class="code" href="classEGS__Vector.html" title="A class representing 3D vectors.">EGS_Vector</a> xp = T ? x*(*T) : x;
        <span class="keywordflow">if</span>( ireg &gt;= 0 ) {
            EGS_Float tmin;
            EGS_Float t1 = xp.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a> + 0.5*ax, t2 = 0.5*ax - xp.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a>;
            <span class="keywordflow">if</span>( t1 &lt; t2 ) tmin = t1; <span class="keywordflow">else</span> tmin = t2;
            t1 = xp.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a> + 0.5*ay; <span class="keywordflow">if</span>( t1 &lt; tmin ) tmin = t1;
            t1 = 0.5*ay - xp.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a>; <span class="keywordflow">if</span>( t1 &lt; tmin ) tmin = t1;
            t1 = xp.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a> + 0.5*az; <span class="keywordflow">if</span>( t1 &lt; tmin ) tmin = t1;
            t1 = 0.5*az - xp.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a>; <span class="keywordflow">if</span>( t1 &lt; tmin ) tmin = t1;
            <span class="keywordflow">return</span> tmin;
        }
        EGS_Float s1=0, s2=0; <span class="keywordtype">int</span> nout = 0;
        <span class="keywordflow">if</span>( 2*xp.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a> + ax &lt; 0 ) {
            EGS_Float t = -0.5*ax - xp.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a>; s1 += t; s2 += t*t; nout++;
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(2*xp.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a> - ax &gt; 0) {
           EGS_Float t = xp.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf" title="x-component">x</a> - 0.5*ax; s1 += t; s2 += t*t;  nout++;
        }
        <span class="keywordflow">if</span>( 2*xp.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a> + ay &lt; 0 ) {
            EGS_Float t = -0.5*ay - xp.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a>; s1 += t; s2 += t*t; nout++;
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(2*xp.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a> - ay &gt; 0) {
           EGS_Float t = xp.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350" title="y-component">y</a> - 0.5*ay; s1 += t; s2 += t*t;  nout++;
        }
        <span class="keywordflow">if</span>( 2*xp.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a> + az &lt; 0 ) {
            EGS_Float t = -0.5*az - xp.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a>; s1 += t; s2 += t*t; nout++;
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(2*xp.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a> - az &gt; 0) {
           EGS_Float t = xp.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87" title="z-component">z</a> - 0.5*az; s1 += t; s2 += t*t;  nout++;
        }
        <span class="keywordflow">if</span>( nout &lt; 2 ) <span class="keywordflow">return</span> s1;
        <span class="keywordflow">return</span> sqrt(s2);
    };

    <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;<a name="a25"></a><a class="code" href="classEGS__BaseGeometry.html#a2df5b0631c3bd57250a6a57cad56323c" title="Get the geometry type.">getType</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> type; };

    <span class="keywordtype">void</span> <a class="code" href="classEGS__BaseGeometry.html#a90b349e45353ab0b7fa32053a9d37085" title="Print information about this geometry.">printInfo</a>() <span class="keyword">const</span>;

};

<span class="preprocessor">#endif</span>
</pre></div><p> The .cpp <a href="file:">file:</a> </p>
<div class="fragment"><pre class="fragment"><span class="comment">/*</span>
<span class="comment">###############################################################################</span>
<span class="comment">#</span>
<span class="comment">#  EGSnrc egs++ box geometry</span>
<span class="comment">#  Copyright (C) 2015 National Research Council Canada</span>
<span class="comment">#</span>
<span class="comment">#  This file is part of EGSnrc.</span>
<span class="comment">#</span>
<span class="comment">#  EGSnrc is free software: you can redistribute it and/or modify it under</span>
<span class="comment">#  the terms of the GNU Affero General Public License as published by the</span>
<span class="comment">#  Free Software Foundation, either version 3 of the License, or (at your</span>
<span class="comment">#  option) any later version.</span>
<span class="comment">#</span>
<span class="comment">#  EGSnrc is distributed in the hope that it will be useful, but WITHOUT ANY</span>
<span class="comment">#  WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</span>
<span class="comment">#  FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for</span>
<span class="comment">#  more details.</span>
<span class="comment">#</span>
<span class="comment">#  You should have received a copy of the GNU Affero General Public License</span>
<span class="comment">#  along with EGSnrc. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="comment">#</span>
<span class="comment">###############################################################################</span>
<span class="comment">#</span>
<span class="comment">#  Author:          Iwan Kawrakow, 2005</span>
<span class="comment">#</span>
<span class="comment">#  Contributors:    Frederic Tessier</span>
<span class="comment">#</span>
<span class="comment">###############################################################################</span>
<span class="comment">*/</span>


<span class="preprocessor">#include &quot;<a class="code" href="egs__box_8h.html" title="A box geometry: header.">egs_box.h</a>&quot;</span>
<span class="preprocessor">#include &quot;<a class="code" href="egs__input_8h.html" title="EGS_Input header file.">egs_input.h</a>&quot;</span>

<span class="keywordtype">void</span> EGS_Box::printInfo()<span class="keyword"> const </span>{
    <a class="code" href="classEGS__BaseGeometry.html#a90b349e45353ab0b7fa32053a9d37085" title="Print information about this geometry.">EGS_BaseGeometry::printInfo</a>();
    <a class="code" href="group__egspp__main.html#ga38c38ac950788399c630481c2b3722f2" title="Always use this function for reporting the progress of a simulation and any other type of information...">egsInformation</a>(<span class="stringliteral">&quot; box size = %g %g %g\n&quot;</span>,ax,ay,az);
    <a class="code" href="group__egspp__main.html#ga38c38ac950788399c630481c2b3722f2" title="Always use this function for reporting the progress of a simulation and any other type of information...">egsInformation</a>(<span class="stringliteral">&quot;=======================================================\n&quot;</span>);
}

<span class="keywordtype">string</span> EGS_Box::type(<span class="stringliteral">&quot;EGS_Box&quot;</span>);

<span class="keyword">static</span> <span class="keywordtype">char</span> EGS_BOX_LOCAL ebox_message1[] = <span class="stringliteral">&quot;createGeometry(box): %s\n&quot;</span>;
<span class="keyword">static</span> <span class="keywordtype">char</span> EGS_BOX_LOCAL ebox_message2[] = <span class="stringliteral">&quot;null input?&quot;</span>;
<span class="keyword">static</span> <span class="keywordtype">char</span> EGS_BOX_LOCAL ebox_message3[] = <span class="stringliteral">&quot;wrong/missing &#39;box size&#39; input?&quot;</span>;
<span class="keyword">static</span> <span class="keywordtype">char</span> EGS_BOX_LOCAL ebox_message4[] =
  <span class="stringliteral">&quot;expecting 1 or 3 float inputs for &#39;box size&#39;&quot;</span>;
<span class="keyword">static</span> <span class="keywordtype">char</span> EGS_BOX_LOCAL ebox_key1[] = <span class="stringliteral">&quot;box size&quot;</span>;

<span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> {

EGS_BOX_EXPORT <a class="code" href="classEGS__BaseGeometry.html">EGS_BaseGeometry</a>* createGeometry(<a class="code" href="classEGS__Input.html" title="A class for storing information in a tree-like structure of key-value pairs. This class is used throu...">EGS_Input</a> *input) {
    <span class="keywordflow">if</span>( !input ) { <a class="code" href="group__egspp__main.html#gadf4109d942f372e48e1dea86c0ca62cb" title="Always use this function for reporting warnings.">egsWarning</a>(ebox_message1,ebox_message2); <span class="keywordflow">return</span> 0; }
    vector&lt;EGS_Float&gt; s;
    <span class="keywordtype">int</span> err = input-&gt;<a class="code" href="classEGS__Input.html#a154f3de14ebb23c3e78316b40b33b719" title="Assign values to an array of strings from an input identified by key.">getInput</a>(ebox_key1,s);
    <span class="keywordflow">if</span>( err ) {
        <a class="code" href="group__egspp__main.html#gadf4109d942f372e48e1dea86c0ca62cb" title="Always use this function for reporting warnings.">egsWarning</a>(ebox_message1,ebox_message3); <span class="keywordflow">return</span> 0;
    }
    <a class="code" href="classEGS__AffineTransform.html" title="A class providing affine transformations.">EGS_AffineTransform</a> *t = <a class="code" href="classEGS__AffineTransform.html#a601a07115aecff1925956a9097e69950" title="Constructs an affine transformation object from the input pointed to by inp and returns a pointer to ...">EGS_AffineTransform::getTransformation</a>(input);
    <a class="code" href="classEGS__Box.html" title="A box geometry.">EGS_Box</a> *result;
    <span class="keywordflow">if</span>( s.size() == 1 ) result = <span class="keyword">new</span> <a class="code" href="classEGS__Box.html" title="A box geometry.">EGS_Box</a>(s[0],t);
    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( s.size() == 3 ) result = <span class="keyword">new</span> <a class="code" href="classEGS__Box.html" title="A box geometry.">EGS_Box</a>(s[0],s[1],s[2],t);
    <span class="keywordflow">else</span> {
        <a class="code" href="group__egspp__main.html#gadf4109d942f372e48e1dea86c0ca62cb" title="Always use this function for reporting warnings.">egsWarning</a>(ebox_message1,ebox_message4);
        <span class="keywordflow">if</span>( t ) <span class="keyword">delete</span> t; <span class="keywordflow">return</span> 0;
    }
    <span class="keywordflow">if</span>( t ) <span class="keyword">delete</span> t;
    result-&gt;<a class="code" href="classEGS__BaseGeometry.html#a77e25cd36d6d94f26338cca9bc98b97d" title="Set the name of the geometry from the input inp.">setName</a>(input);
    result-&gt;<a class="code" href="classEGS__BaseGeometry.html#a28bf612777de14f97108021ae7eb3865" title="Set the media in the geometry from the input pointed to by inp.">setMedia</a>(input);
    result-&gt;<a class="code" href="classEGS__BaseGeometry.html#abc5fa5c48edfbbd913e1939299fe5286" title="Set the labels from an input block.">setLabels</a>(input);
    <span class="keywordflow">return</span> result;
}

}
</pre></div><p> The Makefile: </p>
<div class="fragment"><pre class="fragment">
<span class="preprocessor">###############################################################################</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor">#  EGSnrc egs++ makefile to build box geometry</span>
<span class="preprocessor"></span><span class="preprocessor">#  Copyright (C) 2015 National Research Council Canada</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor">#  This file is part of EGSnrc.</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor">#  EGSnrc is free software: you can redistribute it and/or modify it under</span>
<span class="preprocessor"></span><span class="preprocessor">#  the terms of the GNU Affero General Public License as published by the</span>
<span class="preprocessor"></span><span class="preprocessor">#  Free Software Foundation, either version 3 of the License, or (at your</span>
<span class="preprocessor"></span><span class="preprocessor">#  option) any later version.</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor">#  EGSnrc is distributed in the hope that it will be useful, but WITHOUT ANY</span>
<span class="preprocessor"></span><span class="preprocessor">#  WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</span>
<span class="preprocessor"></span><span class="preprocessor">#  FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for</span>
<span class="preprocessor"></span><span class="preprocessor">#  more details.</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor">#  You should have received a copy of the GNU Affero General Public License</span>
<span class="preprocessor"></span><span class="preprocessor">#  along with EGSnrc. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor">###############################################################################</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor">#  Author:          Iwan Kawrakow, 2005</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor">#  Contributors:</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor">###############################################################################</span>
<span class="preprocessor"></span>

include $(EGS_CONFIG)
include $(SPEC_DIR)egspp.spec
include $(SPEC_DIR)egspp_$(my_machine).conf

DEFS = $(DEF1) -DBUILD_BOX_DLL

library = egs_box
lib_files = egs_box
my_deps = egs_transformations.h
extra_dep = $(addprefix $(DSOLIBS), $(my_deps))

include $(SPEC_DIR)egspp_libs.spec

$(make_depend)
</pre></div><div class="fragment"><pre class="fragment"><span class="comment">/*</span>
<span class="comment">###############################################################################</span>
<span class="comment">#</span>
<span class="comment">#  EGSnrc egs++ box geometry</span>
<span class="comment">#  Copyright (C) 2015 National Research Council Canada</span>
<span class="comment">#</span>
<span class="comment">#  This file is part of EGSnrc.</span>
<span class="comment">#</span>
<span class="comment">#  EGSnrc is free software: you can redistribute it and/or modify it under</span>
<span class="comment">#  the terms of the GNU Affero General Public License as published by the</span>
<span class="comment">#  Free Software Foundation, either version 3 of the License, or (at your</span>
<span class="comment">#  option) any later version.</span>
<span class="comment">#</span>
<span class="comment">#  EGSnrc is distributed in the hope that it will be useful, but WITHOUT ANY</span>
<span class="comment">#  WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</span>
<span class="comment">#  FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for</span>
<span class="comment">#  more details.</span>
<span class="comment">#</span>
<span class="comment">#  You should have received a copy of the GNU Affero General Public License</span>
<span class="comment">#  along with EGSnrc. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="comment">#</span>
<span class="comment">###############################################################################</span>
<span class="comment">#</span>
<span class="comment">#  Author:          Iwan Kawrakow, 2005</span>
<span class="comment">#</span>
<span class="comment">#  Contributors:    Frederic Tessier</span>
<span class="comment">#</span>
<span class="comment">###############################################################################</span>
<span class="comment">*/</span>


<span class="preprocessor">#include &quot;<a class="code" href="egs__box_8h.html" title="A box geometry: header.">egs_box.h</a>&quot;</span>
<span class="preprocessor">#include &quot;<a class="code" href="egs__input_8h.html" title="EGS_Input header file.">egs_input.h</a>&quot;</span>

<span class="keywordtype">void</span> EGS_Box::printInfo()<span class="keyword"> const </span>{
    <a class="code" href="classEGS__BaseGeometry.html#a90b349e45353ab0b7fa32053a9d37085" title="Print information about this geometry.">EGS_BaseGeometry::printInfo</a>();
    <a class="code" href="group__egspp__main.html#ga38c38ac950788399c630481c2b3722f2" title="Always use this function for reporting the progress of a simulation and any other type of information...">egsInformation</a>(<span class="stringliteral">&quot; box size = %g %g %g\n&quot;</span>,ax,ay,az);
    <a class="code" href="group__egspp__main.html#ga38c38ac950788399c630481c2b3722f2" title="Always use this function for reporting the progress of a simulation and any other type of information...">egsInformation</a>(<span class="stringliteral">&quot;=======================================================\n&quot;</span>);
}

<span class="keywordtype">string</span> EGS_Box::type(<span class="stringliteral">&quot;EGS_Box&quot;</span>);

<span class="keyword">static</span> <span class="keywordtype">char</span> EGS_BOX_LOCAL ebox_message1[] = <span class="stringliteral">&quot;createGeometry(box): %s\n&quot;</span>;
<span class="keyword">static</span> <span class="keywordtype">char</span> EGS_BOX_LOCAL ebox_message2[] = <span class="stringliteral">&quot;null input?&quot;</span>;
<span class="keyword">static</span> <span class="keywordtype">char</span> EGS_BOX_LOCAL ebox_message3[] = <span class="stringliteral">&quot;wrong/missing &#39;box size&#39; input?&quot;</span>;
<span class="keyword">static</span> <span class="keywordtype">char</span> EGS_BOX_LOCAL ebox_message4[] =
  <span class="stringliteral">&quot;expecting 1 or 3 float inputs for &#39;box size&#39;&quot;</span>;
<span class="keyword">static</span> <span class="keywordtype">char</span> EGS_BOX_LOCAL ebox_key1[] = <span class="stringliteral">&quot;box size&quot;</span>;

<span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> {

EGS_BOX_EXPORT <a class="code" href="classEGS__BaseGeometry.html">EGS_BaseGeometry</a>* createGeometry(<a class="code" href="classEGS__Input.html" title="A class for storing information in a tree-like structure of key-value pairs. This class is used throu...">EGS_Input</a> *input) {
    <span class="keywordflow">if</span>( !input ) { <a class="code" href="group__egspp__main.html#gadf4109d942f372e48e1dea86c0ca62cb" title="Always use this function for reporting warnings.">egsWarning</a>(ebox_message1,ebox_message2); <span class="keywordflow">return</span> 0; }
    vector&lt;EGS_Float&gt; s;
    <span class="keywordtype">int</span> err = input-&gt;<a class="code" href="classEGS__Input.html#a154f3de14ebb23c3e78316b40b33b719" title="Assign values to an array of strings from an input identified by key.">getInput</a>(ebox_key1,s);
    <span class="keywordflow">if</span>( err ) {
        <a class="code" href="group__egspp__main.html#gadf4109d942f372e48e1dea86c0ca62cb" title="Always use this function for reporting warnings.">egsWarning</a>(ebox_message1,ebox_message3); <span class="keywordflow">return</span> 0;
    }
    <a class="code" href="classEGS__AffineTransform.html" title="A class providing affine transformations.">EGS_AffineTransform</a> *t = <a class="code" href="classEGS__AffineTransform.html#a601a07115aecff1925956a9097e69950" title="Constructs an affine transformation object from the input pointed to by inp and returns a pointer to ...">EGS_AffineTransform::getTransformation</a>(input);
    <a class="code" href="classEGS__Box.html" title="A box geometry.">EGS_Box</a> *result;
    <span class="keywordflow">if</span>( s.size() == 1 ) result = <span class="keyword">new</span> <a class="code" href="classEGS__Box.html" title="A box geometry.">EGS_Box</a>(s[0],t);
    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( s.size() == 3 ) result = <span class="keyword">new</span> <a class="code" href="classEGS__Box.html" title="A box geometry.">EGS_Box</a>(s[0],s[1],s[2],t);
    <span class="keywordflow">else</span> {
        <a class="code" href="group__egspp__main.html#gadf4109d942f372e48e1dea86c0ca62cb" title="Always use this function for reporting warnings.">egsWarning</a>(ebox_message1,ebox_message4);
        <span class="keywordflow">if</span>( t ) <span class="keyword">delete</span> t; <span class="keywordflow">return</span> 0;
    }
    <span class="keywordflow">if</span>( t ) <span class="keyword">delete</span> t;
    result-&gt;<a class="code" href="classEGS__BaseGeometry.html#a77e25cd36d6d94f26338cca9bc98b97d" title="Set the name of the geometry from the input inp.">setName</a>(input);
    result-&gt;<a class="code" href="classEGS__BaseGeometry.html#a28bf612777de14f97108021ae7eb3865" title="Set the media in the geometry from the input pointed to by inp.">setMedia</a>(input);
    result-&gt;<a class="code" href="classEGS__BaseGeometry.html#abc5fa5c48edfbbd913e1939299fe5286" title="Set the labels from an input block.">setLabels</a>(input);
    <span class="keywordflow">return</span> result;
}

}
</pre></div> </div>
</div>
<hr class="footer"/><address class="footer"><small>Generated by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </small></address>
</body>
</html>
